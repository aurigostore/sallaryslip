<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Slip Gaji Internasional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Tambahan library untuk ZIP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .header-blue { background-color: #0d2c54; }
        .section-title-blue { background-color: #1e4a7a; }
        .net-salary-blue { background-color: #0d2c54; }
        .verified-stamp { border: 2px solid #e53e3e; color: #e53e3e; padding: 1rem; text-align: center; }
        #admin-panel-form { display: none; transition: all 0.3s ease-in-out; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-4xl">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Generator Slip Gaji Karyawan</h1>
            <p class="text-gray-600 mt-2">Atur parameter di Panel Admin dan buat slip gaji baru.</p>
        </div>

        <!-- Panel Admin -->
        <div id="admin-panel" class="mb-8 bg-white p-4 rounded-lg shadow-md border">
            <div class="flex justify-between items-center cursor-pointer" id="admin-panel-toggle">
                <h2 class="font-bold text-lg text-gray-700">Panel Admin (Klik untuk Buka/Tutup)</h2>
                <svg id="admin-arrow" class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
            <form id="admin-panel-form" class="mt-4 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- Input Nama Sekolah, Lokasi, Inisial (tidak berubah) -->
                    <div>
                        <label for="input-school-name" class="block text-sm font-medium text-gray-700">Nama Sekolah/Universitas</label>
                        <input type="text" id="input-school-name" value="Universitas Global Mandiri" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="input-school-location" class="block text-sm font-medium text-gray-700">Lokasi</label>
                        <input type="text" id="input-school-location" value="Jakarta" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="input-school-short" class="block text-sm font-medium text-gray-700">Inisial Logo</label>
                        <input type="text" id="input-school-short" value="UGM" maxlength="3" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <!-- PERUBAHAN UI 1: Input Jumlah Slip -->
                    <div>
                        <label for="input-bulk-count" class="block text-sm font-medium text-gray-700">Jumlah Slip (Bulk)</label>
                        <input type="number" id="input-bulk-count" value="1" min="1" max="100" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label for="input-region" class="block text-sm font-medium text-gray-700">Region</label>
                        <select id="input-region" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                           <option value="ID">Indonesia (IDR)</option>
                            <option value="IN">India (INR)</option>
                            <option value="US">Amerika Serikat (USD)</option>
                            <option value="JP">Jepang (JPY)</option>
                            <option value="GB">Britania Raya (GBP)</option>
                            <option value="EU">Uni Eropa (EUR)</option>
                            <option value="AU">Australia (AUD)</option>
                            <option value="PH">Filipina (PHP)</option>
                        </select>
                    </div>
                    <div>
                        <label for="input-min-salary" class="block text-sm font-medium text-gray-700">Gaji Min (IDR)</label>
                        <input type="number" id="input-min-salary" value="5000000" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm">
                    </div>
                    <div>
                        <label for="input-max-salary" class="block text-sm font-medium text-gray-700">Gaji Max (IDR)</label>
                        <input type="number" id="input-max-salary" value="15000000" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm">
                    </div>
                     <div class="flex items-end">
                        <button type="submit" id="save-settings-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Simpan Pengaturan</button>
                    </div>
                </div>
            </form>
        </div>

        <div class="flex justify-center mb-4 gap-4 flex-wrap">
             <!-- PERUBAHAN UI 2: Tombol-tombol baru -->
            <button id="generate-btn" class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">Generate & Siapkan Data</button>
            <button id="download-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">Download (1) Slip as PNG</button>
        </div>
        <!-- PERUBAHAN UI 3: Area Status -->
        <div id="status-area" class="text-center text-gray-700 font-medium mb-8 h-6"></div>

        <!-- Kontainer untuk Slip Gaji (template) -->
        <div id="salary-slip" class="bg-white rounded-lg shadow-2xl overflow-hidden">
            <!-- Isi slip gaji tidak berubah -->
            <div class="header-blue text-white p-6 flex justify-between items-center">
                <div>
                    <h2 id="school-name" class="text-3xl font-bold tracking-wider">UNIVERSITAS GLOBAL MANDIRI</h2>
                    <p id="school-location" class="text-sm opacity-80">Jakarta</p>
                </div>
                <div id="school-logo" class="w-16 h-16 bg-white text-blue-800 rounded-full flex items-center justify-center">
                    <span class="text-2xl font-bold">UGM</span>
                </div>
            </div>
            <div class="border-b-4 border-blue-800 p-4 flex justify-center items-center relative">
                <h3 class="text-3xl font-bold text-blue-900 tracking-widest underline">SALARY SLIP</h3>
                <p id="slip-period" class="text-gray-600 font-medium absolute right-6">For: Agustus 2025</p>
            </div>
            <div class="p-6 border-b">
                <div class="section-title-blue text-white font-semibold py-3 px-4 rounded-t-md inline-block">EMPLOYEE DETAILS</div>
                <div class="border rounded-b-md p-4 space-y-2">
                    <div class="flex py-1">
                        <p class="w-1/3 font-semibold text-gray-700">Name:</p>
                        <p id="employee-name" class="w-2/3 text-gray-800 font-bold">Daniel Riley</p>
                    </div>
                    <div class="flex py-1">
                        <p class="w-1/3 font-semibold text-gray-700">Designation:</p>
                        <p id="employee-designation" class="w-2/3 text-gray-800 font-bold">Dosen Sejarah</p>
                    </div>
                </div>
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <div class="section-title-blue text-white font-semibold py-3 px-4 rounded-t-md inline-block">EARNINGS</div>
                    <div class="border rounded-b-md p-4">
                        <table class="w-full">
                            <tbody>
                                <tr class="border-b"><td class="py-3">Basic Salary</td><td id="earning-basic" class="text-right"></td></tr>
                                <tr class="border-b"><td class="py-3">House Rent Allowance</td><td id="earning-hra" class="text-right"></td></tr>
                                <tr class="border-b"><td class="py-3">Conveyance Allowance</td><td id="earning-conveyance" class="text-right"></td></tr>
                                <tr class="border-b"><td class="py-3">Medical Allowance</td><td id="earning-medical" class="text-right"></td></tr>
                                <tr class="border-b"><td class="py-3">Special Allowance</td><td id="earning-special" class="text-right"></td></tr>
                                <tr><td class="py-3">Other Allowances</td><td id="earning-other" class="text-right"></td></tr>
                            </tbody>
                            <tfoot><tr class="bg-gray-100 font-bold"><td class="py-3 px-2">Total Earnings</td><td id="total-earnings" class="text-right px-2"></td></tr></tfoot>
                        </table>
                    </div>
                </div>
                <div>
                    <div class="section-title-blue text-white font-semibold py-3 px-4 rounded-t-md inline-block">DEDUCTIONS</div>
                    <div class="border rounded-b-md p-4">
                         <table class="w-full">
                            <tbody>
                                <tr class="border-b"><td class="py-3">Provident Fund</td><td id="deduction-pf" class="text-right"></td></tr>
                                <tr class="border-b"><td class="py-3">Professional Tax</td><td id="deduction-tax-prof" class="text-right"></td></tr>
                                <tr class="border-b"><td class="py-3">Income Tax</td><td id="deduction-tax-income" class="text-right"></td></tr>
                                <tr><td class="py-3">Other Deductions</td><td id="deduction-other" class="text-right"></td></tr>
                            </tbody>
                            <tfoot><tr class="bg-gray-100 font-bold"><td class="py-3 px-2">Total Deductions</td><td id="total-deductions" class="text-right px-2"></td></tr></tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <div class="net-salary-blue text-white p-4 mx-6 rounded-md flex justify-between items-center font-bold">
                <span class="text-lg tracking-wider">NET SALARY</span>
                <span id="net-salary" class="text-2xl"></span>
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8 items-end">
                <div class="space-y-2 text-sm text-gray-700">
                    <p><span class="font-semibold">Payment Date:</span> <span id="payment-date"></span></p>
                    <p><span class="font-semibold">Payment Mode:</span> <span id="payment-mode">Bank Transfer</span></p>
                    <p><span class="font-semibold">Bank Account:</span> <span id="bank-account"></span></p>
                    <div class="pt-4 max-w-xs">
                        <div class="verified-stamp">
                            <p class="font-bold text-lg">VERIFIED</p>
                            <p id="verified-school" class="text-sm"></p>
                            <p class="text-xs">Finance Department</p>
                        </div>
                    </div>
                </div>
                <div class="text-center md:text-right">
                    <img id="signature-image" src="https://i.imgur.com/70I23Yg.png" alt="Tanda Tangan" class="h-16 mx-auto md:mx-0 md:ml-auto mb-2">
                    <p id="finance-manager-name" class="border-t pt-2"></p>
                    <p class="text-sm text-gray-600">Finance Manager</p>
                </div>
            </div>
            <div class="bg-gray-100 text-center py-3 px-6 text-xs text-gray-500">
                <span id="footer-school-info"></span> | CONFIDENTIAL - FOR EMPLOYEE USE ONLY
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Referensi elemen UI
    const generateBtn = document.getElementById('generate-btn');
    const downloadBtn = document.getElementById('download-btn');
    const adminPanelToggle = document.getElementById('admin-panel-toggle');
    const adminPanelForm = document.getElementById('admin-panel-form');
    const adminPanelArrow = document.getElementById('admin-arrow');
    const adminForm = document.getElementById('admin-panel-form');
    const bulkCountInput = document.getElementById('input-bulk-count');
    const statusArea = document.getElementById('status-area');

    // Data dan Pengaturan
    const regionSettings = {
        'ID': { currency: 'IDR', locale: 'id-ID', exchangeRate: 1 },
        'IN': { currency: 'INR', locale: 'en-IN', exchangeRate: 195 },
        'US': { currency: 'USD', locale: 'en-US', exchangeRate: 16400 },
        'JP': { currency: 'JPY', locale: 'ja-JP', exchangeRate: 104 },
        'GB': { currency: 'GBP', locale: 'en-GB', exchangeRate: 20800 },
        'EU': { currency: 'EUR', locale: 'de-DE', exchangeRate: 17600 },
        'AU': { currency: 'AUD', locale: 'en-AU', exchangeRate: 10900 },
        'PH': { currency: 'PHP', locale: 'en-PH', exchangeRate: 280 }
    };
    let settings = { schoolName: 'Universitas Global Mandiri', schoolLocation: 'Jakarta', schoolShort: 'UGM', minSalary: 5000000, maxSalary: 15000000, region: 'ID' };
    let bulkSlipsData = []; // Penyimpanan data untuk generate massal

    const employeeNamePartsByRegion = {
        'ID': { first: ['Budi', 'Agus', 'Eko', 'Siti', 'Dewi', 'Rina', 'Adi', 'Putri', 'Joko', 'Tri', 'Ahmad', 'Ani', 'Bayu', 'Citra', 'Dian', 'Fajar', 'Gita', 'Hadi', 'Indah', 'Fitri', 'Rahmat', 'Sri', 'Teguh', 'Utami', 'Wahyu', 'Yulia', 'Zainal', 'Lia', 'Rizki', 'Nurul', 'Dedi', 'Hesti', 'Irfan', 'Kartika', 'Mawar', 'Nugroho', 'Pratiwi', 'Ridwan', 'Sari', 'Taufik', 'Vina', 'Wulan', 'Yoga', 'Zulaikha', 'Bambang', 'Endang', 'Gunawan', 'Ida', 'Lestari', 'Maya'], last: ['Santoso', 'Wijaya', 'Prasetyo', 'Wulandari', 'Lestari', 'Aminah', 'Kusuma', 'Tan', 'Putra', 'Hasan', 'Ningsih', 'Susanto', 'Setiawan', 'Rahman', 'Gunawan', 'Hartono', 'Puspita', 'Wati', 'Maulana', 'Sari', 'Nugroho', 'Permata', 'Widodo', 'Yulianto', 'Effendi', 'Halim', 'Irawan', 'Jayanti', 'Kurniawan', 'Lubis', 'Siregar', 'Manurung', 'Nasution', 'Pangestu', 'Simanjuntak', 'Tanjung', 'Utomo', 'Wibowo', 'Zulkarnain', 'Hakim', 'Chandra', 'Damanik', 'Firmansyah', 'Ginting', 'Hidayat', 'Indrawan', 'Jaelani', 'Kuswoyo', 'Lubis', 'Mandela'] },
        'IN': { first: ['Aarav', 'Vihaan', 'Aditya', 'Reyansh', 'Mohammed', 'Arjun', 'Sai', 'Krishna', 'Ishaan', 'Shaurya', 'Ananya', 'Diya', 'Saanvi', 'Aadhya', 'Pari', 'Myra', 'Kiara', 'Gauri', 'Riya', 'Advika', 'Aryan', 'Rohan', 'Kabir', 'Vivaan', 'Ayaan', 'Dev', 'Neel', 'Om', 'Parth', 'Yash', 'Isha', 'Jiya', 'Kavya', 'Navya', 'Prisha', 'Sara', 'Siya', 'Tara', 'Zara', 'Aisha', 'Devansh', 'Kian', 'Samarth', 'Veer', 'Zayn', 'Anika', 'Avni', 'Fatima', 'Meera', 'Shanaya'], last: ['Sharma', 'Gupta', 'Singh', 'Kumar', 'Verma', 'Patel', 'Shah', 'Khan', 'Mehta', 'Joshi', 'Reddy', 'Rao', 'Das', 'Malhotra', 'Kapoor', 'Chopra', 'Agarwal', 'Mishra', 'Pandey', 'Yadav', 'Choudhary', 'Thakur', 'Jain', 'Saxena', 'Bhat', 'Naidu', 'Pillai', 'Menon', 'Iyer', 'Nair', 'Anand', 'Bose', 'Chatterjee', 'Dutta', 'Ghosh', 'Jha', 'Kaur', 'Lal', 'Mukherjee', 'Nayak', 'Pawar', 'Qureshi', 'Roy', 'Saha', 'Trivedi', 'Upadhyay', 'Varma', 'Walia', 'Zaidi', 'Chauhan'] },
        'US': { first: ['James', 'Robert', 'John', 'Michael', 'David', 'William', 'Richard', 'Joseph', 'Thomas', 'Charles', 'Mary', 'Patricia', 'Jennifer', 'Linda', 'Elizabeth', 'Barbara', 'Susan', 'Jessica', 'Sarah', 'Karen', 'Christopher', 'Daniel', 'Matthew', 'Anthony', 'Mark', 'Donald', 'Steven', 'Paul', 'Andrew', 'Joshua', 'Nancy', 'Lisa', 'Betty', 'Dorothy', 'Sandra', 'Ashley', 'Kimberly', 'Donna', 'Emily', 'Michelle', 'Jason', 'Brian', 'Kevin', 'Gary', 'Timothy', 'Amanda', 'Melissa', 'Deborah', 'Laura', 'Stephanie'], last: ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson', 'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin', 'Lee', 'Perez', 'Thompson', 'White', 'Harris', 'Sanchez', 'Clark', 'Ramirez', 'Lewis', 'Robinson', 'Walker', 'Young', 'Allen', 'King', 'Wright', 'Scott', 'Torres', 'Nguyen', 'Hill', 'Flores', 'Green', 'Adams', 'Nelson', 'Baker', 'Hall', 'Rivera', 'Campbell', 'Mitchell', 'Carter', 'Roberts'] },
        'JP': { first: ['Hiroshi', 'Kenji', 'Taro', 'Akira', 'Ichiro', 'Jiro', 'Saburo', 'Takeshi', 'Makoto', 'Osamu', 'Yuki', 'Hana', 'Rin', 'Sakura', 'Yui', 'Aoi', 'Hinata', 'Mei', 'Emi', 'Saki', 'Satoshi', 'Kazuki', 'Naoki', 'Daiki', 'Kaito', 'Ryota', 'Yuto', 'Sora', 'Tsubasa', 'Haruki', 'Mio', 'Nanami', 'Momoka', 'Ayaka', 'Yuna', 'Kaede', 'Honoka', 'Miki', 'Asuka', 'Haruka', 'Ren', 'Shinji', 'Takumi', 'Yusuke', 'Kenta', 'Ami', 'Chihiro', 'Fumiko', 'Hikari', 'Kana'], last: ['Sato', 'Suzuki', 'Takahashi', 'Tanaka', 'Watanabe', 'Ito', 'Yamamoto', 'Nakamura', 'Kobayashi', 'Kato', 'Yoshida', 'Yamada', 'Sasaki', 'Yamaguchi', 'Matsumoto', 'Inoue', 'Kimura', 'Hayashi', 'Shimizu', 'Mori', 'Abe', 'Ikeda', 'Hashimoto', 'Yamashita', 'Ishikawa', 'Nakajima', 'Maeda', 'Fujita', 'Ogawa', 'Okada', 'Goto', 'Hasegawa', 'Murakami', 'Kondo', 'Ishii', 'Saito', 'Sakai', 'Endo', 'Aoki', 'Fujii', 'Nishimura', 'Fukuda', 'Ota', 'Miura', 'Fujiwara', 'Okamoto', 'Matsuda', 'Nakagawa', 'Nakano', 'Harada'] },
        'GB': { first: ['Oliver', 'George', 'Harry', 'Noah', 'Jack', 'Leo', 'Arthur', 'Muhammad', 'Oscar', 'Charlie', 'Amelia', 'Olivia', 'Isla', 'Ava', 'Mia', 'Ivy', 'Lily', 'Isabella', 'Rosie', 'Sophia', 'Jacob', 'Thomas', 'William', 'Freddie', 'Alfie', 'Henry', 'Theo', 'Archie', 'Joshua', 'James', 'Emily', 'Freya', 'Grace', 'Poppy', 'Ella', 'Charlotte', 'Evie', 'Florence', 'Alice', 'Willow', 'Daniel', 'Edward', 'Logan', 'Lucas', 'Max', 'Daisy', 'Phoebe', 'Sienna', 'Ruby', 'Scarlett'], last: ['Smith', 'Jones', 'Williams', 'Brown', 'Taylor', 'Davies', 'Evans', 'Wilson', 'Thomas', 'Roberts', 'Johnson', 'Lewis', 'Walker', 'Robinson', 'Wood', 'Thompson', 'White', 'Watson', 'Jackson', 'Wright', 'Green', 'Harris', 'Cooper', 'King', 'Lee', 'Martin', 'Clarke', 'James', 'Morgan', 'Hughes', 'Edwards', 'Moore', 'Clark', 'Harrison', 'Scott', 'Young', 'Morris', 'Hall', 'Ward', 'Turner', 'Baker', 'Hill', 'Parker', 'Collins', 'Cook', 'Murphy', 'Bailey', 'Shaw', 'Miller', 'Carter'] },
        'EU': { first: ['Lukas', 'Leon', 'Finn', 'Jonas', 'Felix', 'Elias', 'Paul', 'Noah', 'Ben', 'Louis', 'Marie', 'Sophie', 'Maria', 'Sofia', 'Emma', 'Hanna', 'Mia', 'Anna', 'Lea', 'Lena', 'Matteo', 'Gabriele', 'Leonardo', 'Alessandro', 'Lorenzo', 'Riccardo', 'Tommaso', 'Edoardo', 'Daniele', 'Federico', 'Giulia', 'Alice', 'Ginevra', 'Beatrice', 'Greta', 'Vittoria', 'Aurora', 'Ludovica', 'Chiara', 'Francesca', 'Lucas', 'Hugo', 'Arthur', 'Léo', 'Gabriel', 'Raphaël', 'Jules', 'Adam', 'Maël', 'Louis'], last: ['Müller', 'Schmidt', 'Schneider', 'Fischer', 'Weber', 'Meyer', 'Wagner', 'Becker', 'Schulz', 'Hoffmann', 'Schäfer', 'Koch', 'Bauer', 'Richter', 'Klein', 'Wolf', 'Schröder', 'Neumann', 'Schwarz', 'Zimmermann', 'Rossi', 'Russo', 'Ferrari', 'Esposito', 'Bianchi', 'Romano', 'Colombo', 'Ricci', 'Marino', 'Greco', 'Martin', 'Bernard', 'Dubois', 'Thomas', 'Robert', 'Richard', 'Petit', 'Durand', 'Leroy', 'Moreau', 'Simon', 'Laurent', 'Lefebvre', 'Michel', 'Garcia', 'David', 'Bertrand', 'Roux', 'Vincent', 'Fournier'] },
        'AU': { first: ['Oliver', 'William', 'Jack', 'Noah', 'Henry', 'Leo', 'Lucas', 'Thomas', 'James', 'Charlie', 'Charlotte', 'Amelia', 'Olivia', 'Isla', 'Mia', 'Ava', 'Grace', 'Chloe', 'Willow', 'Matilda', 'Ethan', 'Max', 'Harrison', 'Cooper', 'Lachlan', 'Hudson', 'Alexander', 'Liam', 'Elijah', 'Oscar', 'Ruby', 'Zoe', 'Harper', 'Lily', 'Sophie', 'Ivy', 'Evelyn', 'Ella', 'Sienna', 'Isabelle', 'Archer', 'Flynn', 'Finn', 'Kai', 'Jasper', 'Evie', 'Frankie', 'Aria', 'Audrey', 'Georgia'], last: ['Smith', 'Jones', 'Williams', 'Brown', 'Wilson', 'Taylor', 'Johnson', 'White', 'Martin', 'Anderson', 'Thompson', 'Nguyen', 'Thomas', 'Walker', 'Harris', 'Lee', 'Ryan', 'Robinson', 'Kelly', 'King', 'Campbell', 'Wright', 'Edwards', 'Moore', 'Clark', 'Hill', 'Scott', 'Watson', 'Baker', 'Harrison', 'Young', 'Evans', 'Turner', 'Mitchell', 'Stewart', 'Carter', 'Hall', 'Morris', 'Collins', 'Murray', 'James', 'Roberts', 'Cook', 'Phillips', 'Bell', 'Bailey', 'Ross', 'Green', 'Murphy', 'Davis'] },
        'PH': { first: ['Juan', 'Jose', 'Angelo', 'Miguel', 'Gabriel', 'Nathaniel', 'James', 'Daniel', 'John', 'Jacob', 'Maria', 'Sofia', 'Isabella', 'Angela', 'Andrea', 'Samantha', 'Nathalie', 'Jasmine', 'Christine', 'Bea', 'Carlos', 'Luis', 'Paolo', 'Enrique', 'Marco', 'Antonio', 'Ramon', 'Eduardo', 'Julio', 'Ricardo', 'Catalina', 'Elena', 'Gabriela', 'Isabela', 'Jolina', 'Kristina', 'Liza', 'Marian', 'Nadine', 'Pia', 'Alfonso', 'Benigno', 'Cesar', 'Diego', 'Emilio', 'Felicia', 'Gloria', 'Helena', 'Inez', 'Lourdes'], last: ['Cruz', 'Reyes', 'Santos', 'Garcia', 'Mendoza', 'Gonzales', 'Torres', 'Dela Cruz', 'Villanueva', 'Ramos', 'Castillo', 'Flores', 'Aquino', 'Lim', 'Tan', 'De Leon', 'Soriano', 'Fernandez', 'Perez', 'Mercado', 'Bautista', 'Cabrera', 'Domingo', 'Ferrer', 'Javier', 'Lopez', 'Manalo', 'Marcos', 'Pascual', 'Salazar', 'Santiago', 'Sarmiento', 'Tolentino', 'Valdez', 'Vargas', 'Velasco', 'Yap', 'Aguilar', 'Alonzo', 'Arcellana', 'Balagtas', 'Bonifacio', 'Corpuz', 'Duterte', 'Estrada', 'Gomez', 'Jacinto', 'Luna', 'Mabini', 'Makapagal'] }
    };
    const jobTitles = ['Mathematics Teacher', 'English Teacher', 'History Professor', 'Geography Teacher', 'Physics Lecturer', 'Chemistry Lab Assistant', 'University Librarian', 'Head of Administration', 'Finance Officer', 'Senior Researcher', 'IT Support Staff', 'Admissions Counselor', 'Dean of Students', 'Campus Security Officer', 'Biology Professor', 'Art History Lecturer'];
    const managerNames = ['Ahmad Riyadi', 'Lina Marlina', 'Vikram Singh', 'David Chen', 'Yuki Yamamoto', 'Oliver Williams', 'Jose Santos'];
    const getRandomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

    // Fungsi-fungsi
    const formatCurrency = (amount, regionKey) => {
        const region = regionSettings[regionKey];
        if (!region) return amount;
        let options = { style: 'currency', currency: region.currency, minimumFractionDigits: 2, maximumFractionDigits: 2 };
        if (['IDR', 'JPY', 'PHP'].includes(region.currency)) { options.minimumFractionDigits = 0; options.maximumFractionDigits = 0; }
        return new Intl.NumberFormat(region.locale, options).format(amount);
    };

    const createSlipData = () => {
        const selectedRegionKey = settings.region;
        const exchangeRate = regionSettings[selectedRegionKey].exchangeRate;
        const nameParts = employeeNamePartsByRegion[selectedRegionKey] || employeeNamePartsByRegion['US'];
        const randomFirstName = getRandomItem(nameParts.first);
        const randomLastName = getRandomItem(nameParts.last);
        const randomName = `${randomFirstName} ${randomLastName}`;
        const randomDesignation = getRandomItem(jobTitles);
        const manager = getRandomItem(managerNames);
        
        const minSalaryIDR = parseInt(settings.minSalary);
        const maxSalaryIDR = parseInt(settings.maxSalary);
        const netSalaryIDR = Math.floor(Math.random() * (maxSalaryIDR - minSalaryIDR + 1)) + minSalaryIDR;
        const totalEarningsIDR = Math.round(netSalaryIDR / 0.85);
        const totalDeductionsIDR = totalEarningsIDR - netSalaryIDR;

        const convert = (amount) => amount / exchangeRate;

        return {
            school: { ...settings },
            employee: { name: randomName, designation: randomDesignation },
            financeManager: manager,
            period: new Date().toLocaleString('id-ID', { month: 'long', year: 'numeric' }),
            paymentDate: `01/${(new Date().getMonth() + 1).toString().padStart(2, '0')}/${new Date().getFullYear()}`,
            bankAccount: `XXXXXXXXXX${Math.floor(1000 + Math.random() * 9000)}`,
            earnings: {
                basic: convert(Math.round(totalEarningsIDR * 0.55)),
                hra: convert(Math.round(totalEarningsIDR * 0.25)),
                conveyance: convert(Math.round(totalEarningsIDR * 0.05)),
                medical: convert(Math.round(totalEarningsIDR * 0.03)),
                special: convert(Math.round(totalEarningsIDR * 0.10)),
                other: convert(totalEarningsIDR - Math.round(totalEarningsIDR * 0.98)),
                total: convert(totalEarningsIDR)
            },
            deductions: {
                pf: convert(Math.round(totalDeductionsIDR * 0.60)),
                profTax: convert(Math.round(totalDeductionsIDR * 0.05)),
                incomeTax: convert(Math.round(totalDeductionsIDR * 0.25)),
                other: convert(totalDeductionsIDR - Math.round(totalDeductionsIDR * 0.90)),
                total: convert(totalDeductionsIDR)
            },
            netSalary: convert(netSalaryIDR)
        };
    };

    const updateDOMWithSlipData = (data) => {
        const regionKey = data.school.region;
        document.getElementById('school-name').textContent = data.school.schoolName.toUpperCase();
        document.getElementById('school-location').textContent = data.school.schoolLocation;
        document.getElementById('school-logo').querySelector('span').textContent = data.school.schoolShort;
        document.getElementById('slip-period').textContent = `For: ${data.period}`;
        document.getElementById('employee-name').textContent = data.employee.name;
        document.getElementById('employee-designation').textContent = data.employee.designation;
        document.getElementById('earning-basic').textContent = formatCurrency(data.earnings.basic, regionKey);
        document.getElementById('earning-hra').textContent = formatCurrency(data.earnings.hra, regionKey);
        document.getElementById('earning-conveyance').textContent = formatCurrency(data.earnings.conveyance, regionKey);
        document.getElementById('earning-medical').textContent = formatCurrency(data.earnings.medical, regionKey);
        document.getElementById('earning-special').textContent = formatCurrency(data.earnings.special, regionKey);
        document.getElementById('earning-other').textContent = formatCurrency(data.earnings.other > 0 ? data.earnings.other : 0, regionKey);
        document.getElementById('total-earnings').textContent = formatCurrency(data.earnings.total, regionKey);
        document.getElementById('deduction-pf').textContent = formatCurrency(data.deductions.pf, regionKey);
        document.getElementById('deduction-tax-prof').textContent = formatCurrency(data.deductions.profTax, regionKey);
        document.getElementById('deduction-tax-income').textContent = formatCurrency(data.deductions.incomeTax, regionKey);
        document.getElementById('deduction-other').textContent = formatCurrency(data.deductions.other > 0 ? data.deductions.other : 0, regionKey);
        document.getElementById('total-deductions').textContent = formatCurrency(data.deductions.total, regionKey);
        document.getElementById('net-salary').textContent = formatCurrency(data.netSalary, regionKey);
        document.getElementById('payment-date').textContent = data.paymentDate;
        document.getElementById('bank-account').textContent = data.bankAccount;
        document.getElementById('verified-school').textContent = data.school.schoolName;
        document.getElementById('finance-manager-name').textContent = data.financeManager;
        document.getElementById('footer-school-info').textContent = `${data.school.schoolName}, ${data.school.schoolLocation}`;
    };

    const updateButtonsAndStatus = (count) => {
        statusArea.textContent = `Berhasil membuat ${count} set data slip gaji. Siap diunduh.`;
        downloadBtn.disabled = false;
        generateBtn.disabled = true;
        generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
        
        if (count === 1) {
            downloadBtn.textContent = `Download Slip as PNG`;
        } else {
            downloadBtn.textContent = `Download (${count}) Slips as ZIP`;
        }
    };

    const resetUI = () => {
        bulkSlipsData = [];
        statusArea.textContent = '';
        downloadBtn.disabled = true;
        generateBtn.disabled = false;
        generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        downloadBtn.textContent = 'Download (1) Slip as PNG';
    };

    // Event Listeners
    adminPanelToggle.addEventListener('click', () => {
        const isHidden = adminPanelForm.style.display === 'none';
        adminPanelForm.style.display = isHidden ? 'block' : 'none';
        adminPanelArrow.classList.toggle('rotate-180', isHidden);
    });

    adminForm.addEventListener('submit', (e) => {
        e.preventDefault();
        settings.schoolName = document.getElementById('input-school-name').value;
        settings.schoolLocation = document.getElementById('input-school-location').value;
        settings.schoolShort = document.getElementById('input-school-short').value;
        settings.minSalary = document.getElementById('input-min-salary').value;
        settings.maxSalary = document.getElementById('input-max-salary').value;
        settings.region = document.getElementById('input-region').value;
        
        const saveBtn = document.getElementById('save-settings-btn');
        saveBtn.textContent = 'Disimpan!';
        saveBtn.classList.add('bg-blue-500');
        saveBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
        setTimeout(() => {
            saveBtn.textContent = 'Simpan Pengaturan';
            saveBtn.classList.remove('bg-blue-500');
            saveBtn.classList.add('bg-green-600', 'hover:bg-green-700');
        }, 1500);
        resetUI();
    });

    generateBtn.addEventListener('click', () => {
        const count = parseInt(bulkCountInput.value, 10);
        bulkSlipsData = [];
        for (let i = 0; i < count; i++) {
            bulkSlipsData.push(createSlipData());
        }
        updateDOMWithSlipData(bulkSlipsData[0]); // Tampilkan yang pertama sebagai preview
        updateButtonsAndStatus(count);
    });

    downloadBtn.addEventListener('click', async () => {
        if (bulkSlipsData.length === 0) return;

        const count = bulkSlipsData.length;
        downloadBtn.disabled = true;
        statusArea.textContent = 'Mempersiapkan unduhan...';
        
        if (count === 1) {
            // Logika download PNG tunggal
            statusArea.textContent = 'Membuat gambar...';
            const slipElement = document.getElementById('salary-slip');
            const originalShadow = slipElement.style.boxShadow;
            slipElement.style.boxShadow = 'none';
            
            await document.fonts.ready;
            const _ = slipElement.offsetHeight; // Force reflow
            setTimeout(async () => {
                 const canvas = await html2canvas(slipElement, { scale: 2, useCORS: true, logging: false });
                 const fileName = `${bulkSlipsData[0].employee.name.replace(/ /g, '-')}.png`;
                 const link = document.createElement('a');
                 link.download = fileName;
                 link.href = canvas.toDataURL('image/png');
                 link.click();
                 slipElement.style.boxShadow = originalShadow;
                 resetUI();
            }, 500);
        } else {
            // Logika download ZIP massal
            const zip = new JSZip();
            const slipElement = document.getElementById('salary-slip');
            const originalShadow = slipElement.style.boxShadow;
            slipElement.style.boxShadow = 'none';
            await document.fonts.ready;

            for (let i = 0; i < bulkSlipsData.length; i++) {
                const data = bulkSlipsData[i];
                statusArea.textContent = `Memproses slip ${i + 1} dari ${count}...`;
                updateDOMWithSlipData(data);
                const _ = slipElement.offsetHeight; // Force reflow
                await new Promise(resolve => setTimeout(resolve, 50)); // Jeda kecil
                
                const canvas = await html2canvas(slipElement, { scale: 2, useCORS: true, logging: false });
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                const fileName = `${data.employee.name.replace(/ /g, '-')}.png`;
                zip.file(fileName, blob);
            }

            statusArea.textContent = 'Membuat file ZIP...';
            const zipBlob = await zip.generateAsync({ type: 'blob' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(zipBlob);
            link.download = `Slip-Gaji-Batch-${new Date().getTime()}.zip`;
            link.click();
            URL.revokeObjectURL(link.href);
            
            slipElement.style.boxShadow = originalShadow;
            resetUI();
        }
    });

    // Inisialisasi awal
    resetUI();
    updateDOMWithSlipData(createSlipData()); // Tampilkan satu slip saat pertama kali dimuat

});
</script>

</body>
</html>

